<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/cell-32x32-next.png"><link rel="icon" href="/img/cell-32x32-next.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="laser"><meta name="keywords" content=""><meta name="description" content="完成数据清洗之后，需要提取有意义的样本特征输入模型中训练，目的是为了更高效的利用算法。提取特征的步骤叫特征工程，分为三步：特征提取、特征预处理、特征降维。下面将针对时序序列的特征工程进行讲述。"><meta property="og:type" content="article"><meta property="og:title" content="时间序列特征工程"><meta property="og:url" content="https://easyboy-blog.com/characteristic-engineering-of-time-series.html"><meta property="og:site_name" content="home-laser"><meta property="og:description" content="完成数据清洗之后，需要提取有意义的样本特征输入模型中训练，目的是为了更高效的利用算法。提取特征的步骤叫特征工程，分为三步：特征提取、特征预处理、特征降维。下面将针对时序序列的特征工程进行讲述。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/时间特征.407xag8uznw0.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/%E6%97%B6%E5%BA%8F%E8%A7%84%E5%BE%8B%E7%89%B9%E5%BE%81.5n1vvk2y3d40.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/%E7%BB%9F%E8%AE%A1%E7%89%B9%E5%BE%81.6ahmg2mw8s00.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/%E6%BB%9A%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%8E%9F%E8%A1%A8%E7%BB%93%E6%9E%84.119hmuad0jy8.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/tsfresh%E7%AA%97%E5%8F%A3%E5%BA%8F%E5%88%97.4f2dy005fr40.jpg"><meta property="article:published_time" content="2022-04-23T06:50:40.006Z"><meta property="article:modified_time" content="2022-04-23T12:19:22.937Z"><meta property="article:author" content="laser"><meta property="article:tag" content="机器学习"><meta property="article:tag" content="时间序列"><meta property="article:tag" content="特征工程"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/时间特征.407xag8uznw0.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>时间序列特征工程 - home-laser</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"easyboy-blog.com",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"left",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="home-laser" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>EASY</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/wallpaper_img/wallhaven-9my82x_1920x1091.5ivtqxlw8ho0.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="时间序列特征工程"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-04-23 14:50" pubdate>2022年4月23日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 7.3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 61 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="padding-left:2rem;margin-right:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">时间序列特征工程</h1><div class="markdown-body"><p>完成数据清洗之后，需要提取有意义的样本特征输入模型中训练，目的是为了更高效的利用算法。提取特征的步骤叫特征工程，分为三步：特征提取、特征预处理、特征降维。下面将针对时序序列的特征工程进行讲述。</p><span id="more"></span><h1 id="1-特征提取"><a href="#1-特征提取" class="headerlink" title="1. 特征提取"></a>1. 特征提取</h1><p>提取时间序列的特征可以从三方面着手。</p><h2 id="1-1-从时间中提取特征"><a href="#1-1-从时间中提取特征" class="headerlink" title="1.1 从时间中提取特征"></a>1.1 从时间中提取特征</h2><p>每条样本数据对应的时间数据包含很多信息，可以从中发现时间上的一些规律特征。<br>提取时间特征可以对时间进行拆解，如2022.04.23 15:08:03，可以将其中年月日时分秒分别拆解为一列，或者以某个时间点为起点，计算经过的时间，如一天中的第几分钟，一年中的第几天或第几周等等。对于受季节、节假日影响的数据，也可以判断是否月初、月末、周末、公共假期、营业时间等等。<br><strong>举例程序实现：</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre class="language-hljs python">df = Month_data_1T.iloc[:,<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]<br>df[<span class="hljs-string">'时间'</span>] = df.index<br><span class="hljs-comment"># 年份</span><br>df[<span class="hljs-string">'年'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.year)<br><span class="hljs-comment"># 月份</span><br>df[<span class="hljs-string">'月'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.month)<br><span class="hljs-comment"># 日</span><br>df[<span class="hljs-string">'日'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.day)<br><span class="hljs-comment"># 小时</span><br>df[<span class="hljs-string">'时'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.hour)<br><span class="hljs-comment"># 分钟</span><br>df[<span class="hljs-string">'分'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.minute)<br><span class="hljs-comment"># 一天中的第几分钟</span><br>df[<span class="hljs-string">'一天中的第几分钟'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.minute + x.hour*<span class="hljs-number">60</span>)<br><span class="hljs-comment"># 星期几；</span><br>df[<span class="hljs-string">'星期几'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.dayofweek)<br><span class="hljs-comment"># 一年中的第几天</span><br>df[<span class="hljs-string">'一年中的第几天'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.dayofyear)<br><span class="hljs-comment"># # 一年中的第几周</span><br><span class="hljs-comment"># df['一年中的第几周']=df['时间'].apply(lambda x: x.week)</span><br><span class="hljs-comment"># 一天中哪个时间段：凌晨、早晨、上午、中午、下午、傍晚、晚上、深夜；</span><br>period_dict ={<br>    <span class="hljs-number">23</span>: <span class="hljs-number">0x00</span>, <span class="hljs-number">0</span>: <span class="hljs-number">0x00</span>, <span class="hljs-number">1</span>: <span class="hljs-number">0x00</span>,<br>    <span class="hljs-number">2</span>: <span class="hljs-number">0x01</span>, <span class="hljs-number">3</span>: <span class="hljs-number">0x01</span>, <span class="hljs-number">4</span>: <span class="hljs-number">0x01</span>,<br>    <span class="hljs-number">5</span>: <span class="hljs-number">0x02</span>, <span class="hljs-number">6</span>: <span class="hljs-number">0x02</span>, <span class="hljs-number">7</span>: <span class="hljs-number">0x02</span>,<br>    <span class="hljs-number">8</span>: <span class="hljs-number">0x03</span>, <span class="hljs-number">9</span>: <span class="hljs-number">0x03</span>, <span class="hljs-number">10</span>: <span class="hljs-number">0x03</span>, <span class="hljs-number">11</span>: <span class="hljs-number">0x03</span>,<br>    <span class="hljs-number">12</span>: <span class="hljs-number">0x04</span>, <span class="hljs-number">13</span>: <span class="hljs-number">0x04</span>,<span class="hljs-number">14</span>: <span class="hljs-number">0x04</span>, <br>    <span class="hljs-number">15</span>: <span class="hljs-number">0x05</span>, <span class="hljs-number">16</span>: <span class="hljs-number">0x05</span>, <span class="hljs-number">17</span>: <span class="hljs-number">0x05</span>,<span class="hljs-number">18</span>: <span class="hljs-number">0x05</span>,<br>    <span class="hljs-number">19</span>: <span class="hljs-number">0x07</span>, <span class="hljs-number">20</span>: <span class="hljs-number">0x07</span>, <span class="hljs-number">21</span>: <span class="hljs-number">0x07</span>, <span class="hljs-number">22</span>: <span class="hljs-number">0x07</span>,<br><span class="hljs-comment">#     23: '深夜', 0: '深夜', 1: '深夜',</span><br><span class="hljs-comment">#     2: '凌晨', 3: '凌晨', 4: '凌晨',</span><br><span class="hljs-comment">#     5: '早晨', 6: '早晨', 7: '早晨',</span><br><span class="hljs-comment">#     8: '上午', 9: '上午', 10: '上午', 11: '上午',</span><br><span class="hljs-comment">#     12: '中午', 13: '中午',14: '中午',</span><br><span class="hljs-comment">#     15: '下午', 16: '下午', 17: '下午',18: '下午',</span><br><span class="hljs-comment">#     19: '晚上', 20: '晚上', 21: '晚上', 22: '晚上',</span><br>}<br>df[<span class="hljs-string">'时间段'</span>]=df[<span class="hljs-string">'时'</span>].<span class="hljs-built_in">map</span>(period_dict)<br><span class="hljs-comment"># # 一年中的哪个季度</span><br><span class="hljs-comment"># season_dict = {</span><br><span class="hljs-comment">#     1: '春季', 2: '春季', 3: '春季',</span><br><span class="hljs-comment">#     4: '夏季', 5: '夏季', 6: '夏季',</span><br><span class="hljs-comment">#     7: '秋季', 8: '秋季', 9: '秋季',</span><br><span class="hljs-comment">#     10: '冬季', 11: '冬季', 12: '冬季',</span><br><span class="hljs-comment"># }</span><br><span class="hljs-comment"># df['季节']=df['月'].map(season_dict)</span><br><span class="hljs-comment"># # 是否闰年</span><br><span class="hljs-comment"># df['是否闰年'] = df['时间'].apply(lambda x: x.is_leap_year)</span><br><span class="hljs-comment"># 是否月初</span><br>df[<span class="hljs-string">'是否月初'</span>] = df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.is_month_start)<br><span class="hljs-comment"># 是否月末</span><br>df[<span class="hljs-string">'是否月末'</span>] = df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.is_month_end)<br><span class="hljs-comment"># 是否季节初</span><br><span class="hljs-comment"># df['是否季节初'] = df['时间'].apply(lambda x: x.is_quarter_start)</span><br><span class="hljs-comment"># 是否季节末</span><br><span class="hljs-comment"># df['是否季节末'] = df['时间'].apply(lambda x: x.is_quarter_end)</span><br><span class="hljs-comment"># 是否年初</span><br><span class="hljs-comment"># df['是否年初'] = df['时间'].apply(lambda x: x.is_year_start)</span><br><span class="hljs-comment"># 是否年尾</span><br><span class="hljs-comment"># df['是否年尾'] = df['时间'].apply(lambda x: x.is_year_end)</span><br><span class="hljs-comment"># 是否周末</span><br>df[<span class="hljs-string">'是否周末'</span>] = df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> x.dayofweek <span class="hljs-keyword">in</span> [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>] <span class="hljs-keyword">else</span> <span class="hljs-literal"><code class="language-hljs python">df = Month_data_1T.iloc[:,<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]<br>df[<span class="hljs-string">'时间'</span>] = df.index<br><span class="hljs-comment"># 年份</span><br>df[<span class="hljs-string">'年'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.year)<br><span class="hljs-comment"># 月份</span><br>df[<span class="hljs-string">'月'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.month)<br><span class="hljs-comment"># 日</span><br>df[<span class="hljs-string">'日'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.day)<br><span class="hljs-comment"># 小时</span><br>df[<span class="hljs-string">'时'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.hour)<br><span class="hljs-comment"># 分钟</span><br>df[<span class="hljs-string">'分'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.minute)<br><span class="hljs-comment"># 一天中的第几分钟</span><br>df[<span class="hljs-string">'一天中的第几分钟'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.minute + x.hour*<span class="hljs-number">60</span>)<br><span class="hljs-comment"># 星期几；</span><br>df[<span class="hljs-string">'星期几'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.dayofweek)<br><span class="hljs-comment"># 一年中的第几天</span><br>df[<span class="hljs-string">'一年中的第几天'</span>]=df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.dayofyear)<br><span class="hljs-comment"># # 一年中的第几周</span><br><span class="hljs-comment"># df['一年中的第几周']=df['时间'].apply(lambda x: x.week)</span><br><span class="hljs-comment"># 一天中哪个时间段：凌晨、早晨、上午、中午、下午、傍晚、晚上、深夜；</span><br>period_dict ={<br>    <span class="hljs-number">23</span>: <span class="hljs-number">0x00</span>, <span class="hljs-number">0</span>: <span class="hljs-number">0x00</span>, <span class="hljs-number">1</span>: <span class="hljs-number">0x00</span>,<br>    <span class="hljs-number">2</span>: <span class="hljs-number">0x01</span>, <span class="hljs-number">3</span>: <span class="hljs-number">0x01</span>, <span class="hljs-number">4</span>: <span class="hljs-number">0x01</span>,<br>    <span class="hljs-number">5</span>: <span class="hljs-number">0x02</span>, <span class="hljs-number">6</span>: <span class="hljs-number">0x02</span>, <span class="hljs-number">7</span>: <span class="hljs-number">0x02</span>,<br>    <span class="hljs-number">8</span>: <span class="hljs-number">0x03</span>, <span class="hljs-number">9</span>: <span class="hljs-number">0x03</span>, <span class="hljs-number">10</span>: <span class="hljs-number">0x03</span>, <span class="hljs-number">11</span>: <span class="hljs-number">0x03</span>,<br>    <span class="hljs-number">12</span>: <span class="hljs-number">0x04</span>, <span class="hljs-number">13</span>: <span class="hljs-number">0x04</span>,<span class="hljs-number">14</span>: <span class="hljs-number">0x04</span>, <br>    <span class="hljs-number">15</span>: <span class="hljs-number">0x05</span>, <span class="hljs-number">16</span>: <span class="hljs-number">0x05</span>, <span class="hljs-number">17</span>: <span class="hljs-number">0x05</span>,<span class="hljs-number">18</span>: <span class="hljs-number">0x05</span>,<br>    <span class="hljs-number">19</span>: <span class="hljs-number">0x07</span>, <span class="hljs-number">20</span>: <span class="hljs-number">0x07</span>, <span class="hljs-number">21</span>: <span class="hljs-number">0x07</span>, <span class="hljs-number">22</span>: <span class="hljs-number">0x07</span>,<br><span class="hljs-comment">#     23: '深夜', 0: '深夜', 1: '深夜',</span><br><span class="hljs-comment">#     2: '凌晨', 3: '凌晨', 4: '凌晨',</span><br><span class="hljs-comment">#     5: '早晨', 6: '早晨', 7: '早晨',</span><br><span class="hljs-comment">#     8: '上午', 9: '上午', 10: '上午', 11: '上午',</span><br><span class="hljs-comment">#     12: '中午', 13: '中午',14: '中午',</span><br><span class="hljs-comment">#     15: '下午', 16: '下午', 17: '下午',18: '下午',</span><br><span class="hljs-comment">#     19: '晚上', 20: '晚上', 21: '晚上', 22: '晚上',</span><br>}<br>df[<span class="hljs-string">'时间段'</span>]=df[<span class="hljs-string">'时'</span>].<span class="hljs-built_in">map</span>(period_dict)<br><span class="hljs-comment"># # 一年中的哪个季度</span><br><span class="hljs-comment"># season_dict = {</span><br><span class="hljs-comment">#     1: '春季', 2: '春季', 3: '春季',</span><br><span class="hljs-comment">#     4: '夏季', 5: '夏季', 6: '夏季',</span><br><span class="hljs-comment">#     7: '秋季', 8: '秋季', 9: '秋季',</span><br><span class="hljs-comment">#     10: '冬季', 11: '冬季', 12: '冬季',</span><br><span class="hljs-comment"># }</span><br><span class="hljs-comment"># df['季节']=df['月'].map(season_dict)</span><br><span class="hljs-comment"># # 是否闰年</span><br><span class="hljs-comment"># df['是否闰年'] = df['时间'].apply(lambda x: x.is_leap_year)</span><br><span class="hljs-comment"># 是否月初</span><br>df[<span class="hljs-string">'是否月初'</span>] = df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.is_month_start)<br><span class="hljs-comment"># 是否月末</span><br>df[<span class="hljs-string">'是否月末'</span>] = df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: x.is_month_end)<br><span class="hljs-comment"># 是否季节初</span><br><span class="hljs-comment"># df['是否季节初'] = df['时间'].apply(lambda x: x.is_quarter_start)</span><br><span class="hljs-comment"># 是否季节末</span><br><span class="hljs-comment"># df['是否季节末'] = df['时间'].apply(lambda x: x.is_quarter_end)</span><br><span class="hljs-comment"># 是否年初</span><br><span class="hljs-comment"># df['是否年初'] = df['时间'].apply(lambda x: x.is_year_start)</span><br><span class="hljs-comment"># 是否年尾</span><br><span class="hljs-comment"># df['是否年尾'] = df['时间'].apply(lambda x: x.is_year_end)</span><br><span class="hljs-comment"># 是否周末</span><br>df[<span class="hljs-string">'是否周末'</span>] = df[<span class="hljs-string">'时间'</span>].apply(<span class="hljs-keyword">lambda</span> x: <span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> x.dayofweek <span class="hljs-keyword">in</span> [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>] <span class="hljs-keyword">else</span> <span class="hljs-literal">False</span>)<br>df<br></code></span></pre></td></tr></tbody></table></figure><p>结果如下图所示：</p><div align="center"><img src="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/时间特征.407xag8uznw0.jpg" srcset="/img/loading.gif" lazyload></div><h2 id="1-2-从时序规律中提取特征"><a href="#1-2-从时序规律中提取特征" class="headerlink" title="1.2 从时序规律中提取特征"></a>1.2 从时序规律中提取特征</h2><p>在数据清洗后的数据分析中，通常会分析时间序列的一些特性，如周期性、时间序列分解、历史数据，可以把这些分析出来的数据用作特征。<br>**举例程序实现： **</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-keyword">from</span> statsmodels.tsa.seasonal <span class="hljs-keyword">import</span> seasonal_decompose<br><span class="hljs-comment"># 数据含有两个周期77和1440</span><br><span class="hljs-comment"># 偏移6min差分</span><br>df[<span class="hljs-string">"Hu0_-5S"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">6</span>)<br><span class="hljs-comment"># 偏移77min差分，一小周期</span><br>df[<span class="hljs-string">"Hu0_-1period"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">1</span>*<span class="hljs-number">77</span>)<br><span class="hljs-comment"># 偏移两小周期</span><br>df[<span class="hljs-string">"Hu0_-2period"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">2</span>*<span class="hljs-number">77</span>)<br><span class="hljs-comment"># 偏移1天，一大周期</span><br>df[<span class="hljs-string">"Hu0_-1day"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">1</span>*<span class="hljs-number">1440</span>)<br>decompose_result = seasonal_decompose(df[<span class="hljs-string">'Hu_0'</span>], model=<span class="hljs-string">"additive"</span>, period=<span class="hljs-number">77</span>)<br><span class="hljs-comment"># 分离77周期分离</span><br>df[<span class="hljs-string">"Hu0_77seasonal"</span>] = decompose_result.seasonal<br>decompose_result = seasonal_decompose(decompose_result.seasonal, model=<span class="hljs-string">"additive"</span>, period=<span class="hljs-number">1440</span>)<br><span class="hljs-comment"># 分离1440周期分量</span><br>df[<span class="hljs-string">"Hu0_1440seasonal"</span>] = decompose_result.seasonal<br><span class="hljs-comment"># 趋势分量</span><br>df[<span class="hljs-string">"Hu0_trend"</span>] = decompose_result.trend<br><span class="hljs-comment"># 残差分量</span><br>df[<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">from</span> statsmodels.tsa.seasonal <span class="hljs-keyword">import</span> seasonal_decompose<br><span class="hljs-comment"># 数据含有两个周期77和1440</span><br><span class="hljs-comment"># 偏移6min差分</span><br>df[<span class="hljs-string">"Hu0_-5S"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">6</span>)<br><span class="hljs-comment"># 偏移77min差分，一小周期</span><br>df[<span class="hljs-string">"Hu0_-1period"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">1</span>*<span class="hljs-number">77</span>)<br><span class="hljs-comment"># 偏移两小周期</span><br>df[<span class="hljs-string">"Hu0_-2period"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">2</span>*<span class="hljs-number">77</span>)<br><span class="hljs-comment"># 偏移1天，一大周期</span><br>df[<span class="hljs-string">"Hu0_-1day"</span>] = df[<span class="hljs-string">'Hu_0'</span>].shift(<span class="hljs-number">1</span>*<span class="hljs-number">1440</span>)<br>decompose_result = seasonal_decompose(df[<span class="hljs-string">'Hu_0'</span>], model=<span class="hljs-string">"additive"</span>, period=<span class="hljs-number">77</span>)<br><span class="hljs-comment"># 分离77周期分离</span><br>df[<span class="hljs-string">"Hu0_77seasonal"</span>] = decompose_result.seasonal<br>decompose_result = seasonal_decompose(decompose_result.seasonal, model=<span class="hljs-string">"additive"</span>, period=<span class="hljs-number">1440</span>)<br><span class="hljs-comment"># 分离1440周期分量</span><br>df[<span class="hljs-string">"Hu0_1440seasonal"</span>] = decompose_result.seasonal<br><span class="hljs-comment"># 趋势分量</span><br>df[<span class="hljs-string">"Hu0_trend"</span>] = decompose_result.trend<br><span class="hljs-comment"># 残差分量</span><br>df[<span class="hljs-string">"Hu0_resid"</span>] = decompose_result.resid<br>df<br></code></span></pre></td></tr></tbody></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/%E6%97%B6%E5%BA%8F%E8%A7%84%E5%BE%8B%E7%89%B9%E5%BE%81.5n1vvk2y3d40.jpg" srcset="/img/loading.gif" lazyload alt="时序规律特征"></p><h2 id="1-3-从统计窗口提取特征"><a href="#1-3-从统计窗口提取特征" class="headerlink" title="1.3 从统计窗口提取特征"></a>1.3 从统计窗口提取特征</h2><p>要想提取时间序列的统计特征，需要按固定时间长度把一条时间序列划分为n多条子序列，然后对这些子序列分别构造统计特征。<br>**举例程序实现： **</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-comment"># sum() 值的总和</span><br><span class="hljs-comment"># mean() 均值</span><br><span class="hljs-comment"># median() 值的算术中值</span><br><span class="hljs-comment"># min() 最小值</span><br><span class="hljs-comment"># max() 最大</span><br><span class="hljs-comment"># std() 贝塞尔修正样本标准差(均方差)</span><br><span class="hljs-comment"># var() 无偏方差</span><br><span class="hljs-comment"># cov() 无偏协方差（二元）</span><br><span class="hljs-comment"># corr() 相关（二进制）</span><br><span class="hljs-comment"># variation_v = std_v/mean_v 离散系数</span><br><span class="hljs-comment"># polyfit 线性拟合，求斜率</span><br><br><span class="hljs-comment">#使用rolling滚动窗口，窗口大小为7</span><br>roll_data = df[<span class="hljs-string">'Hu_0'</span>].rolling(window=<span class="hljs-number">7</span>)<br>df[<span class="hljs-string">"Hu0_mean"</span>] = roll_data.mean()<br>df[<span class="hljs-string">"Hu0_median"</span>] = roll_data.median()<br>df[<span class="hljs-string">"Hu0_min"</span>] = roll_data.<span class="hljs-built_in">min</span>()<br>df[<span class="hljs-string">"Hu0_max"</span>] = roll_data.<span class="hljs-built_in">max</span>()<br>df[<span class="hljs-string">"Hu0_std"</span>] = roll_data.std()<br>df[<span class="hljs-string">"Hu0_var"</span>] = roll_data.var()<br>df[<span class="hljs-string">"Hu0_cov"</span>] = roll_data.cov()<br>df[<span class="hljs-string">"Hu0_corr"</span>] = roll_data.corr()<br>df[<span class="hljs-string">"Hu0_variation"</span>] = df[<span class="hljs-string">"Hu0_std"</span>]/df[<span class="hljs-string">"Hu0_mean"</span>]<br>df[<span class="hljs-string">"Hu0_sum"</span>] = roll_data.<span class="hljs-built_in">sum</span>()<br>df[<span class="hljs-string">"Hu0_sum_diff2"</span>] = df[<span class="hljs-string">"Hu0_sum"</span>].shift(<span class="hljs-number">1</span>)-df[<span class="hljs-string">"Hu0_sum"</span>].shift(<span class="hljs-number">2</span>)<br><span class="hljs-comment"># df["Hu0_autocorr1"] = df["Hu_0"].autocorr(1)</span><br><span class="hljs-comment"># df["Hu0_autocorr2"] = df["Hu_0"].autocorr(2)</span><br>x = <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>)<br>z = <span class="hljs-keyword">lambda</span> y : np.polyfit(x, y, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>df[<span class="hljs-string">"Hu0_polyfit"</span>] = roll_data.apply(z)<br><span class="hljs-comment"># 一阶差分的均方差</span><br>roll_data_diff = df[<span class="hljs-string">'Hu_0'</span>].diff(<span class="hljs-number">1</span>).rolling(window=<span class="hljs-number">7</span>)<br>df[<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment"># sum() 值的总和</span><br><span class="hljs-comment"># mean() 均值</span><br><span class="hljs-comment"># median() 值的算术中值</span><br><span class="hljs-comment"># min() 最小值</span><br><span class="hljs-comment"># max() 最大</span><br><span class="hljs-comment"># std() 贝塞尔修正样本标准差(均方差)</span><br><span class="hljs-comment"># var() 无偏方差</span><br><span class="hljs-comment"># cov() 无偏协方差（二元）</span><br><span class="hljs-comment"># corr() 相关（二进制）</span><br><span class="hljs-comment"># variation_v = std_v/mean_v 离散系数</span><br><span class="hljs-comment"># polyfit 线性拟合，求斜率</span><br><br><span class="hljs-comment">#使用rolling滚动窗口，窗口大小为7</span><br>roll_data = df[<span class="hljs-string">'Hu_0'</span>].rolling(window=<span class="hljs-number">7</span>)<br>df[<span class="hljs-string">"Hu0_mean"</span>] = roll_data.mean()<br>df[<span class="hljs-string">"Hu0_median"</span>] = roll_data.median()<br>df[<span class="hljs-string">"Hu0_min"</span>] = roll_data.<span class="hljs-built_in">min</span>()<br>df[<span class="hljs-string">"Hu0_max"</span>] = roll_data.<span class="hljs-built_in">max</span>()<br>df[<span class="hljs-string">"Hu0_std"</span>] = roll_data.std()<br>df[<span class="hljs-string">"Hu0_var"</span>] = roll_data.var()<br>df[<span class="hljs-string">"Hu0_cov"</span>] = roll_data.cov()<br>df[<span class="hljs-string">"Hu0_corr"</span>] = roll_data.corr()<br>df[<span class="hljs-string">"Hu0_variation"</span>] = df[<span class="hljs-string">"Hu0_std"</span>]/df[<span class="hljs-string">"Hu0_mean"</span>]<br>df[<span class="hljs-string">"Hu0_sum"</span>] = roll_data.<span class="hljs-built_in">sum</span>()<br>df[<span class="hljs-string">"Hu0_sum_diff2"</span>] = df[<span class="hljs-string">"Hu0_sum"</span>].shift(<span class="hljs-number">1</span>)-df[<span class="hljs-string">"Hu0_sum"</span>].shift(<span class="hljs-number">2</span>)<br><span class="hljs-comment"># df["Hu0_autocorr1"] = df["Hu_0"].autocorr(1)</span><br><span class="hljs-comment"># df["Hu0_autocorr2"] = df["Hu_0"].autocorr(2)</span><br>x = <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>)<br>z = <span class="hljs-keyword">lambda</span> y : np.polyfit(x, y, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]<br>df[<span class="hljs-string">"Hu0_polyfit"</span>] = roll_data.apply(z)<br><span class="hljs-comment"># 一阶差分的均方差</span><br>roll_data_diff = df[<span class="hljs-string">'Hu_0'</span>].diff(<span class="hljs-number">1</span>).rolling(window=<span class="hljs-number">7</span>)<br>df[<span class="hljs-string">"Hu0_diff_std"</span>] = roll_data_diff.std()<br>df<br></code></span></pre></td></tr></tbody></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/%E7%BB%9F%E8%AE%A1%E7%89%B9%E5%BE%81.6ahmg2mw8s00.jpg" srcset="/img/loading.gif" lazyload alt="统计特征"></p><h1 id="2-特征预处理"><a href="#2-特征预处理" class="headerlink" title="2. 特征预处理"></a>2. 特征预处理</h1><p>特征预处理是对提取出来的特征无量纲化，目的是让特征处于同等地位，避免特征之间差异太大而影响模型学习效果。常用的处理手段有两种：归一化和标准化。归一化是将原数据映射到[m,n]（通常为[0,1]）内，但当数据异常点较多时，容易影响归一化结果，适合小样本。标准化是将数据变换为均值为0，标准差为1的范围内。而平均值和标准差受异常值影响较小，能克服归一化的缺点。此处使用标准化进行举例。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br><span class="hljs-comment"><code class="language-hljs python"><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br><span class="hljs-comment">#因为上式返回结果为series，这里将其转换为表格形式。</span><br>df_Standar = pd.DataFrame(scaler.fit_transform(df),index=df.index, columns=df.columns)<br>df_Standar<br></code></span></pre></td></tr></tbody></table></figure><h1 id="3-特征降维"><a href="#3-特征降维" class="headerlink" title="3. 特征降维"></a>3. 特征降维</h1><p>特征降维指的是对提取出来的特征进行过滤筛选，减少特征维度。目的是为了降低学习任务的难度和减轻维度灾难问题。<br>通常，从两个方面考虑来选择特征：</p><ol><li>特征是否发散<br>如果一个特征不发散，例如方差接近于0，也就是说样本在这个特征上基本上没有差异，这个特征对于样本的区分并没有什么用。</li><li>特征与目标的相关性<br>与目标相关性高的特征，应当优先选择。<br>区别：特征与特征之间相关性高的，应当优先去除掉其中一个特征，因为它们是替代品。<br>特征选择方法有：Filter过滤法、Wrapper包装法和Embedded嵌入法。其中第二三种方法都适合于有监督学习，需要与目标值关联进行特征选择。因为原数据是为异常检测，没有标签，属于无监督学习，这里仅举例过滤法。<br>通过筛选小方差和强相关特征来达到过滤特征的目的。<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-comment"># 特征过滤 filter</span><br><span class="hljs-keyword">from</span> sklearn.feature_selection <span class="hljs-keyword">import</span> VarianceThreshold  <br>X_train_columns = df_Standar.columns<br><span class="hljs-comment">#方差过滤，返回方差大于设定阈值的列</span><br>selector = VarianceThreshold(<span class="hljs-number">0.5</span>)<br>X = selector.fit_transform(df_Standar)<br><span class="hljs-comment">#因为上式返回结果为series，这里将其转换为表格形式。</span><br><span class="hljs-comment">#X_train_columns[selector.get_support(indices=True)]结果为筛选后的列名</span><br>df_filter = pd.DataFrame(X,index=df_concat.index, columns=X_train_columns[selector.get_support(indices=<span class="hljs-literal"><code class="language-hljs python"><span class="hljs-comment"># 特征过滤 filter</span><br><span class="hljs-keyword">from</span> sklearn.feature_selection <span class="hljs-keyword">import</span> VarianceThreshold  <br>X_train_columns = df_Standar.columns<br><span class="hljs-comment">#方差过滤，返回方差大于设定阈值的列</span><br>selector = VarianceThreshold(<span class="hljs-number">0.5</span>)<br>X = selector.fit_transform(df_Standar)<br><span class="hljs-comment">#因为上式返回结果为series，这里将其转换为表格形式。</span><br><span class="hljs-comment">#X_train_columns[selector.get_support(indices=True)]结果为筛选后的列名</span><br>df_filter = pd.DataFrame(X,index=df_concat.index, columns=X_train_columns[selector.get_support(indices=<span class="hljs-literal">True</span>)])<br>df_filter<br></code></span></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-comment"># 特征过滤 相关系数corr</span><br><span class="hljs-comment"># 剔除相关性系数高于threshold的corr_drop</span><br>corr_df = df_filter.corr()<br>threshold = <span class="hljs-number">0.9</span><br><span class="hljs-comment">#k=1,返回上三角矩阵</span><br>upper = corr_df.where(np.triu(np.ones(corr_df.shape), k=<span class="hljs-number">1</span>).astype(np.<span class="hljs-built_in">bool</span>))<br><span class="hljs-comment">#返回相关系数大于阈值的列名</span><br>corr_drop = [column <span class="hljs-keyword">for</span> column <span class="hljs-keyword">in</span> upper.columns <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(upper[column].<span class="hljs-built_in">abs</span>() &gt; threshold)]<br>df_filter = df_filter.drop(corr_drop,axis=<span class="hljs-number"><code class="language-hljs python"><span class="hljs-comment"># 特征过滤 相关系数corr</span><br><span class="hljs-comment"># 剔除相关性系数高于threshold的corr_drop</span><br>corr_df = df_filter.corr()<br>threshold = <span class="hljs-number">0.9</span><br><span class="hljs-comment">#k=1,返回上三角矩阵</span><br>upper = corr_df.where(np.triu(np.ones(corr_df.shape), k=<span class="hljs-number">1</span>).astype(np.<span class="hljs-built_in">bool</span>))<br><span class="hljs-comment">#返回相关系数大于阈值的列名</span><br>corr_drop = [column <span class="hljs-keyword">for</span> column <span class="hljs-keyword">in</span> upper.columns <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(upper[column].<span class="hljs-built_in">abs</span>() &gt; threshold)]<br>df_filter = df_filter.drop(corr_drop,axis=<span class="hljs-number">1</span>)<br>df_filter<br></code></span></pre></td></tr></tbody></table></figure><h1 id="4-Tsfresh特征提取工具"><a href="#4-Tsfresh特征提取工具" class="headerlink" title="4. Tsfresh特征提取工具"></a>4. Tsfresh特征提取工具</h1>最后讲一个用于时间序列特征提取的工具<a target="_blank" rel="noopener" href="https://tsfresh.readthedocs.io/en/latest/index.html">tsfresh</a><br>工具介绍就不讲了，直接说一下用法。对于一条长时间序列，要想利用tsfresh工具提取特征，还需要先将其化为一个个子窗口序列。该工具包内就包含这个功能。原表结构为：<br><img src="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/%E6%BB%9A%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%8E%9F%E8%A1%A8%E7%BB%93%E6%9E%84.119hmuad0jy8.jpg" srcset="/img/loading.gif" lazyload alt="滚动窗口原表结构"></li></ol><p>其中id,time列是在原表的基础上后加上的，目的是为了方便使用API接口函数。id代表组别，time代表时间顺序。然后使用API转换为窗口子序列。</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-keyword">from</span> tsfresh.utilities.dataframe_functions <span class="hljs-keyword">import</span> roll_time_series<br><span class="hljs-comment"># 滚动窗口</span><br><span class="hljs-comment">#max_timeshift:最大偏移量，min_timeshift：最小偏移量，rolling_direction：每次移动的大小和方向。column_sort按什么排序，默认已从小到大排好</span><br>df_rolled = roll_time_series(one_data, column_id=<span class="hljs-string">"id"</span>, column_sort=<span class="hljs-string">"time"</span>,max_timeshift = <span class="hljs-number">6</span> ,min_timeshift = <span class="hljs-number">6</span>,rolling_direction=-<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> tsfresh.utilities.dataframe_functions <span class="hljs-keyword">import</span> roll_time_series<br><span class="hljs-comment"># 滚动窗口</span><br><span class="hljs-comment">#max_timeshift:最大偏移量，min_timeshift：最小偏移量，rolling_direction：每次移动的大小和方向。column_sort按什么排序，默认已从小到大排好</span><br>df_rolled = roll_time_series(one_data, column_id=<span class="hljs-string">"id"</span>, column_sort=<span class="hljs-string">"time"</span>,max_timeshift = <span class="hljs-number">6</span> ,min_timeshift = <span class="hljs-number">6</span>,rolling_direction=-<span class="hljs-number">1</span>)<br>df_rolled<br></code></span></pre></td></tr></tbody></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fight-ing-go/image_repository@master/202204/Characteristic-Engineering-of-Time-Series/tsfresh%E7%AA%97%E5%8F%A3%E5%BA%8F%E5%88%97.4f2dy005fr40.jpg" srcset="/img/loading.gif" lazyload alt="tsfresh窗口序列"><br>转化后的id是原id与原时间的组合，也为后面特征提取中的组别。（1，1）代表1号组别的第一个时间点组成的子序列，（1，43316）代表1号组别第43316个点组成的子序列。然后再进行特征提取.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class="language-hljs python"><span class="hljs-keyword">from</span> tsfresh <span class="hljs-keyword">import</span> extract_features<br><span class="hljs-comment"># 特征提取,使用drop先删去多余的列，column_id为组别</span><br>df_features = extract_features(df_rolled.drop([<span class="hljs-string">"date"</span>,<span class="hljs-string">"time"</span>],axis = <span class="hljs-number">1</span>), column_id=<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">from</span> tsfresh <span class="hljs-keyword">import</span> extract_features<br><span class="hljs-comment"># 特征提取,使用drop先删去多余的列，column_id为组别</span><br>df_features = extract_features(df_rolled.drop([<span class="hljs-string">"date"</span>,<span class="hljs-string">"time"</span>],axis = <span class="hljs-number">1</span>), column_id=<span class="hljs-string">"id"</span>)<br>df_features<br></code></span></pre></td></tr></tbody></table></figure><p>以上即为tsfresh特征提取的步骤，其内置的特征过滤函数因需要目标值而不适用我的数据，所以后续特征降维仍使用上述过滤法进行选择。</p><blockquote><p>参考网站：<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1536537">特征工程系列：时间特征构造以及时间序列特征构造</a><br><a target="_blank" rel="noopener" href="https://www.heywhale.com/mw/project/5d86eced8499bc002c108cc8">特征工程理论与代码实现特征工程理论与代码实现</a></p></blockquote></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="category-chain-item">机器学习</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">#机器学习</a> <a href="/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97/">#时间序列</a> <a href="/tags/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/">#特征工程</a></div></div><div class="license-box my-3"><div class="license-title"><div>时间序列特征工程</div><div>https://easyboy-blog.com/characteristic-engineering-of-time-series.html</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>laser</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年4月23日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/installing-mariadb-with-bat-in-windows-7-environment.html" title="Windows7环境bat安装mariadb"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Windows7环境bat安装mariadb</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/centos7-an-zhuang-qt-ji-huan-jing-pei-zhi.html" title="centos7安装QT及环境配置"><span class="hidden-mobile">centos7安装QT及环境配置</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.4.17/Valine.min.js",(function(){var i=Object.assign({appId:"TSl5PlExO22wiwkA3e15kGvM-gzGzoHsz",appKey:"36AERjunsq15rL0xcz3ovKbG",path:"window.location.pathname",placeholder:"尽情吐槽吧~",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:"",emojiCDN:null,emojiMaps:null,enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>