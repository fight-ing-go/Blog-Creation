<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/cell-32x32-next.png"><link rel="icon" href="/img/cell-32x32-next.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="laser"><meta name="keywords" content=""><meta name="description" content="网络模型OSI七层模型 OSI (0pen System Interconnection）参考模型，即开放式系统互联。参考模型是国际标准化组织(ISO）制定的一个用于计算机或通信系统间互联的标准体系。它是一个七层的、抽象的模型体，不仅包括一系列抽象的术语或概念，也包括具体的协议。    物理层: 主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用是传输比"><meta property="og:type" content="article"><meta property="og:title" content="Linux网络通信基础（2）"><meta property="og:url" content="https://haochendaily.com/network-communications-2.html"><meta property="og:site_name" content="home-laser"><meta property="og:description" content="网络模型OSI七层模型 OSI (0pen System Interconnection）参考模型，即开放式系统互联。参考模型是国际标准化组织(ISO）制定的一个用于计算机或通信系统间互联的标准体系。它是一个七层的、抽象的模型体，不仅包括一系列抽象的术语或概念，也包括具体的协议。    物理层: 主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用是传输比"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.30iywjhxoso0.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.48vygkw2asa0.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.3td2pwxt8dg0.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.54mqaowxcu40.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.64852rkjs6o0.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.35nzeiey6n20.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.119s9rsspmkw.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.5tm763m2j7k0.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.1pvv2b5pbi3k.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.50a67ttz4z40.jpg"><meta property="og:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.54pe05a6goc0.jpg"><meta property="article:published_time" content="2022-08-01T13:09:20.775Z"><meta property="article:modified_time" content="2022-08-01T13:33:26.393Z"><meta property="article:author" content="laser"><meta property="article:tag" content="网络通信"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.30iywjhxoso0.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><title>Linux网络通信基础（2） - home-laser</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"haochendaily.com",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"C"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"left",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.0.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="home-laser" type="application/atom+xml">
</head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>EASY</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/wallpaper_img/wallhaven-9my82x_1920x1091.5ivtqxlw8ho0.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Linux网络通信基础（2）"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-08-01 21:09" pubdate>2022年8月1日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.6k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 47 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="padding-left:2rem;margin-right:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Linux网络通信基础（2）</h1><div class="markdown-body"><h1 id="网络模型"><a href="#网络模型" class="headerlink" title="网络模型"></a>网络模型</h1><h2 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h2><blockquote><p>OSI (0pen System Interconnection）参考模型，即开放式系统互联。参考模型是国际标准化组织(ISO）制定的一个<strong>用于计算机或通信系统间互联的标准体系</strong>。它是一个七层的、抽象的模型体，不仅包括一系列抽象的术语或概念，也包括具体的协议。</p></blockquote><p><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.30iywjhxoso0.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><ol><li><strong>物理层:</strong> 主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用是<strong>传输比特流</strong>(就是由1、0转化为电流强弱来进行传输，到达目的地后再转化为1、0，也就是我们常说的数模转换与模数转换)。这一层的数据叫做比特。（比特流-&gt;高低电平-&gt;比特流）</li><li><strong>数据链路层:</strong> 建立逻辑连接、进行<strong>硬件地址寻址</strong>、差错校验等功能。定义了如何<strong>让格式化数据以帧为单位进行传输</strong>，以及如何控制对物理介质的访问。将比特组合成字节进而组合成帧，用MAC地址访问介质。(传输时，先是发送端从网络层（IP地址寻址）到数据链路层（MAC寻址），IP地址是确定到哪个区域，MAC是具体哪个设备)</li><li><strong>网络层:</strong> 进行<strong>逻辑地址寻址</strong>(IP地址)，在位于不同地理位置的网络中的两个主机系统之间提供连接和路径选择。Internet的发展使得从世界各站点访问信息的用户数大大增加，而网络层正是管理这种连接的层。</li><li><strong>传输层:</strong> 定义了一些传输数据的协议和端口号（WWW端口80等)，如:TCP、UDP。主要是将从下层接收的数据进行分段和传输，到达目的地址后再进行重组。常常把这一层数据叫做段。</li><li><strong>会话层:</strong> 通过传输层（端口号:传输端口与接收端口）建立数据传输的通路。主要在你的系统之间发起会话或者接受会话请求。（保存连接信息，不需要重复进行IP寻址等操作）</li><li><strong>表示层:</strong> 数据的表示、安全、压缩。主要是进行对接收的数据进行解释、加密与解密、压缩与解压缩等（也就是把计算机能够识别的东西转换成人能够能识别的东西(如图片、声音等)。</li><li><strong>应用层:</strong> 网络服务与最终用户的一个接口。这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真)提供网络服务。</li></ol><h2 id="TCP-x2F-IP四层模型"><a href="#TCP-x2F-IP四层模型" class="headerlink" title="TCP/IP四层模型"></a>TCP/IP四层模型</h2><blockquote><p>现在Internet(因特网）使用的主流协议族是TCP/IP协议族，它是一个分层、多协议的通信体系。TCP/IP协议族是一个四层协议系统，自底而上分别是数据链路层、网络层、传输层和应用层。每一层完成不同的功能，且通过若干协议来实现，上层协议使用下层协议提供的服务。</p></blockquote><p><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.48vygkw2asa0.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><ol><li><strong>应用层:</strong> 应用层是TCP/IP协议的第一层，是直接为应用进程提供服务的。<br>(1)对不同种类的应用程序它们会根据自己的需要来使用应用层的不同协议，邮件传输应用使用了SMTP协议、万维网应用使用了HTTP协议、远程登录服务应用使用了有TELNET协议。<br>(2）应用层还能加密、解密、格式化数据。<br>(3)应用层可以建立或解除与其他节点的联系，这样可以充分节省网络资源。</li><li><strong>传输层:</strong> 作为TCP/IP协议的第二层，传输层在整个TCP/IP协议中起到了中流砥柱的作用。且在传输层中，TCP和UDP也同样起到了中流砥柱的作用。</li><li><strong>网络层:</strong> 网络层在TCP/IP协议中的位于第三层。在TCP/IP协议中网络层可以进行网络连接的建立和终止以及IP地址的寻找等功能。</li><li><strong>网络接口层:</strong> 在TCP/IP协议中，网络接口层位于第四层。由于网络接口层兼并了物理层和数据链路层所以，网络接口层既是传输数据的物理媒介，也可以为网络层提供—条准确无误的线路。</li></ol><h1 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h1><blockquote><p>协议，网络协议的简称，网络协议是通信计算机双方必须共同遵从的一组约定。如怎么样建立连接、怎么样互相识别等。只有遵守这个约定，计算机之间才能相互通信交流。<strong>它的三要素是:语法、语义、时序</strong>。协议最终体现为在网络上传输的数据包的格式。<br>协议往往分成几个层次进行定义，分层定义是为了使某一层协议的改变不影响其他层次的协议。</p></blockquote><h2 id="常见协议"><a href="#常见协议" class="headerlink" title="常见协议"></a>常见协议</h2><p><strong>应用层常见的协议有：</strong>FTP协议(File Transfer Protocol文件传输协议)、HTTP协议(Hyper Text TransferProtocol超文本传输协议)、NFS (Network File System网络文件系统)。<br><strong>传输层常见协议有:</strong> TCP协议(Transmission Control Protocol传输控制协议)、UDP协议(User DatagramProtocol 用户数据报协议)。<br><strong>网络层常见协议有:</strong> IP协议(Internet Protocol因特网互联协议）、ICMP协议(Internet Control MessageProtocol因特网控制报文协议)、IGMP协议(Internet Group Management Protocol因特网组管理协议)。<br><strong>网络接口层常见协议有:</strong> ARP协议(Address Resolution Protocol地址解析协议)、RARP协议(ReverseAddress Resolution Protocol反向地址解析协议)。</p><h2 id="UDP协议"><a href="#UDP协议" class="headerlink" title="UDP协议"></a>UDP协议</h2><p>UDP数据包的结构如下图。</p><p><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.3td2pwxt8dg0.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p>按顺序为：<br><strong>源端口号：</strong>发送方的端口号<br><strong>目的端口号：</strong>接收方的端口号<br><strong>长度：</strong>要发送的UDP数据报的长度，最小值为8（仅有首部）<br><strong>校验和：</strong>检验UDP数据报中是否有发送错误，有就丢弃<br><strong>数据：</strong>如果有的话，就是实际发送的数据包</p><h2 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h2><p>TCP数据包的结构如下图。</p><p><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.54mqaowxcu40.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p>按顺序为：<br><strong>源端口号：</strong>发送方的端口号<br><strong>目的端口号：</strong>接收方的端口号<br><strong>序列号：</strong>本报文段的数据的第一个字节的序号<br><strong>确认序号：</strong>期望收到对方下一个报文段的第一个数据字节的序号<br><strong>首部长度（数据偏移）：</strong>TCP报文端的数据起始处距离TCP报文段的起始处有多远，即首部长度。单位为32位，即以4字节为计算单位，0001-&gt;4字节<br><strong>保留：</strong>占6位，保留以后使用，置0<br><strong>紧急URG：</strong>置1，表明紧急指针字段有效，它告诉系统此报文有紧急数据，应尽快传送</p><h2 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h2><p>IP数据包的结构如下图。<br><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.64852rkjs6o0.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p><strong>版本:</strong> IP协议的版本。通信双方使用过的IP协议的版本必须一致，目前最广泛使用的IP协议版本号为4(即IPv4)<br><strong>首部长度:</strong> 单位是32位（4字节)<br><strong>服务类型:</strong> 一般不适用，取值为0<br><strong>总长度:</strong> 指首部加上数据的总长度，单位为字节<br><strong>标识(identification):</strong> IP软件在存储器中维持一个计数器，每产生一个数据报，计数器就加1，并将此值赋给标识字段<br><strong>标志(flag) :</strong> 目前只有两位有意义。<br>标志字段中的最低位记为MF。MF= 1即表示后面′还有分片”的数据报。MF=0表示这已是若干数据报片中的最后一个。<br>标志字段中间的一位记为DF，意思是”不能分片”，只有当DF=0时才允许分片<br><strong>片偏移︰</strong> 指出较长的分组在分片后,其片在源分组中的相对位置，也就是说，相对于用户数据段的起点，该片从何处开始。片偏移以8字节为偏移单位。<br><strong>生存时间:</strong> TTL，表明是数据报在网络中的寿命，即为“跳数限制””，由发出数据报的源点设置这个字段。路由器在转发数据之前就把TTL值减—，当TTL值减为零时，就丢弃这个数据报。<br><strong>协议:</strong> 指出此数据报携带的数据时使用何种协议，以便使目的主机的IP层知道应将数据部分上交给哪个处理过程，常用的ICMP(1)，IGMP(2)，TCP(6)，UDP(17)，IPv6 (41)<br><strong>首部校验和:</strong> 只校验数据报的首部，不包括数据部分。<br><strong>源地址:</strong> 发送方IP地址<br><strong>目的地址:</strong> 接收方IP地址</p><h2 id="以太网协议"><a href="#以太网协议" class="headerlink" title="以太网协议"></a>以太网协议</h2><p>以太网数据包的结构如下图。<br><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.35nzeiey6n20.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p>类型:0x800表示IP、0x806表示ARP、0x835表示RARP</p><h2 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h2><p>ARP数据报的结构如下图:<br><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.119s9rsspmkw.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p>**硬件类型:**1表示MAC地址<br>**协议类型:**0x800表示IP地址<br>**硬件地址长度:**6<br>**协议地址长度:**4<br>**操作:**1表示ARP请求，2表示ARP应答，3表示 RARP请求，4表示 RARP应答</p><h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p>上层协议是如何使用下层协议提供的服务的呢?其实这是通过封装实现的。应用程序数据在发送到物理网络上之前，将沿着协议栈从上往下依次传递。每层协议都将在上层数据的基础上加上自己的头部信息(有时还包括尾部信息)，以实现该层的功能，这个过程就称为封装。如下图所示。<br><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.5tm763m2j7k0.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><h1 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h1><p>所谓socket(套接字)，就是对网络中不同主机上的应用进程之间进行双向通信的端点的抽象。套接字上联应用进程，下联网络协议栈。<br>socket 可以看成是两个网络应用程序进行通信时，各自通信连接中的端点，这是一个逻辑上的概念。它是网络环境中进程间通信的API，<strong>socket是由IP地址和端口结合的</strong>，提供向应用层进程传送数据包的机制。<br>在Linux环境下，socket用于表示进程间网络通信的特殊文件类型。本质为内核借助缓冲区形成的<strong>伪文件</strong>，可以使用文件描述符引用套接字。与管道类似的，Linux系统将其封装成文件的目的是为了<strong>统一接口</strong>，使得读写套接字和读写文件的操作一致。区别是管道主要应用于本地进程间通信，而<strong>套接字多应用于网络进程间数据的传递</strong>。</p><h2 id="字节序"><a href="#字节序" class="headerlink" title="字节序"></a>字节序</h2><p>字节序，顾名思义宁节的顺序，就是大于一个字节类型的数据在内存中的存放顺序(一个字节的数据当然就无需谈顺序的问题了)。<br>目的是规范信息单元（如比特、字节、字）的传送顺序。<br>字节序分为<strong>大端字节序(Big-Endian)和小端字节序(Little-Endian)<strong>。大端字节序是指一个整数的最高位字节(23<del>31bit)存储在内存的低地址处，低位字节(0</del>7bit)存储在内存的高地址处;小端字节序则是指整数的高位字节存储在内存的高地址处，而低位字节则存储在内存的低地址处。<br>为避免收发方字节序不一致，</strong>发送端总是把要发送的数据转换成大端字节序数据后再发送</strong>，而接收端知道对方传送过来的数据总是采用大端字节序，所以接收端可以根据自身采用的字节序决定是否对接收到的数据进行转换（小端机转换，大端机不转换)。<br>BSD Socket提供了封装好的转换接口，方便程序员使用。包括从主机字节序到网络字节序的转换函数: htons、htonl;从网络字节序到主机字节序的转换函数: ntohs、ntohl。</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">h - host主机，主机字节序<br>to -转换成什么<br>n- network网络字节序<br>s - <span class="hljs-type">short</span><br><span class="hljs-number">1</span>- <span class="hljs-type">long</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-comment">//转换端口</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">htons</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> hostshort)</span>;	<span class="hljs-comment">//主机字节序–网络字节序</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">ntohs</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> netshort)</span> ;	<span class="hljs-comment">//网络字节序–主机字节序</span><br><br><span class="hljs-comment">//转IP</span><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">hton1</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> hostlong)</span> ;	<span class="hljs-comment">//主机字节序–网络字节序</span><br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">ntoh1</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> net1ong)</span>;	<span class="hljs-comment">//网络字节序–主机字节序</span><br></code></pre></td></tr></tbody></table></figure><h2 id="socket地址"><a href="#socket地址" class="headerlink" title="socket地址"></a>socket地址</h2><blockquote><p>socket地址其实是一个结构体，封装端口号和IP等信息。</p></blockquote><h3 id="通用socket地址"><a href="#通用socket地址" class="headerlink" title="通用socket地址"></a>通用socket地址</h3><p>socket网络编程接口中，表示socket地址的是结构体sockaddr：</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/socket.h&gt;</span></span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> {</span><br>    <span class="hljs-type">sa_family_t</span> sa_family;<br>    <span class="hljs-type">char</span> sa_data[<span class="hljs-number">14</span>];<br>};<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">sa_fami1y_t</span>;<br></code></pre></td></tr></tbody></table></figure><p>其中sa_family_t是地址族类型，比如当接口为IPv4时，对应变量值为AF_INET。常见协议族和地址族如下图。（协议族和对应地址族的值是一样的，所以经常会混用）<br><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.1pvv2b5pbi3k.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p>sa_data成员用于存放socket地址值。比如IPv4地址值有2位端口号和4位IP地址，剩下8位为空。不同的协议族的地址值具有不同的含义和长度，如下所示:</p><p><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.50a67ttz4z40.jpg" srcset="/img/loading.gif" lazyload alt="image"></p><p>但是当socket地址为IPv6时，sa_data的空间已经不够了，所以Linux新建了通用的socket，如下所示。</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/socket.h&gt;</span></span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sockaddr</span> _<span class="hljs-title">storage</span>{</span><br>    <span class="hljs-type">sa_family_t</span> sa_family;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">int</span> __ss_align;<br>    <span class="hljs-type">char</span> __ss_padding[ <span class="hljs-number">128</span> - <span class="hljs-keyword">sizeof</span>(__ss_align) ];<br>};<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">short</span> <span class="hljs-type">int</span> <span class="hljs-type">sa_family_t</span>;<br><br></code></pre></td></tr></tbody></table></figure><h3 id="专用socket地址"><a href="#专用socket地址" class="headerlink" title="专用socket地址"></a>专用socket地址</h3><p>实际开发中，并不会去直接使用上述通用socket地址，而是使用专用的sockaddr_in和sockaddr_in6，然后再将其指针转为（sockaddr *）类型传递给相关函数，其的是类似（void *）的作用。</p><img src="https://cdn.staticaly.com/gh/fight-ing-go/image_repository@master/202207/Network-foundation/image.54pe05a6goc0.jpg" srcset="/img/loading.gif" lazyload alt="image" style="zoom:80%"><p><strong>所有socket编程接口使用的地址参数类型都是sockaddr，所有专用socket地址在使用时都需要强转为通用sockaddr类型。</strong></p><h2 id="IP地址转换函数"><a href="#IP地址转换函数" class="headerlink" title="IP地址转换函数"></a>IP地址转换函数</h2><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arpa/inet.h&gt;</span></span><br><span class="hljs-comment">// p:点分十进制的IP字符串,n:表示network，网络字节序的整数</span><br><span class="hljs-comment">//讲表示IP的点分十进制的字符串转换为网络字节序的整数</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">inet_pton</span><span class="hljs-params">(<span class="hljs-type">int</span> af，<span class="hljs-type">const</span> <span class="hljs-type">char</span> *src，<span class="hljs-type">void</span> *dst)</span> ;<br>	af:地址族:AF_INET AF_INET6<br>	src:需要转换的点分十进制的IP字符串<br>    dst:转换后的结果保存在这个里面<br><span class="hljs-comment">//将网络字节序的整数，转换成点分十进制的IP地址字符串</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title function_">inet_ntop</span><span class="hljs-params">(<span class="hljs-type">int</span> af，<span class="hljs-type">const</span> <span class="hljs-type">void</span> *src，<span class="hljs-type">char</span> *dst，<span class="hljs-type">socklen_t</span> size)</span>;<br>    af:地址族:AF_INET AF_INET6<br>    src:要转换的ip的整数的地址<br>    dst:转换成IP地址字符串保存的地方<br>    size:第三个参数的大小（数组的大小)<br>    返回值:返回转换后的数据的地址&lt;字符串&gt;，和dst是一样的<br><br></code></pre></td></tr></tbody></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/" class="category-chain-item">网络通信</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">#网络通信</a></div></div><div class="license-box my-3"><div class="license-title"><div>Linux网络通信基础（2）</div><div>https://haochendaily.com/network-communications-2.html</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>laser</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年8月1日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/network-communications-3.html" title="Linux网络通信基础（3）"><span class="hidden-mobile">Linux网络通信基础（3）</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments("#valine",(function(){Fluid.utils.createScript("https://lib.baomitu.com/valine/1.4.17/Valine.min.js",(function(){var i=Object.assign({appId:"TSl5PlExO22wiwkA3e15kGvM-gzGzoHsz",appKey:"36AERjunsq15rL0xcz3ovKbG",path:"window.location.pathname",placeholder:"尽情吐槽吧~",avatar:"retro",meta:["nick","mail","link"],requiredFields:[],pageSize:10,lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:"",emojiCDN:null,emojiMaps:null,enableQQ:!1},{el:"#valine",path:window.location.pathname});new Valine(i),Fluid.utils.waitElementVisible("#valine .vcontent",()=>{var i="#valine .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>